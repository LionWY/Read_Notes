# 用僵尸对象调试内存管理问题

> 启用“僵尸对象”（Zombie Object）后，运行期系统会把所有已经回收的实例转化成特殊的僵尸对象，其所在的内存将无法重用，因此不可能遭到覆写

1. 僵尸对象收到消息后，会抛出异常，其中准确说明了发送过来的消息，并描述了回收之前的那个对象

2. 编辑应用程序的Scheme，对话框左侧选择“Run”，切换至“Diagnostics”分页，勾选“Enable Zombie Objects”

3. 僵尸对象工作原理：
	
	* 启动僵尸对象功能后，在回收对象时，系统会把对象转化为僵尸对象，而不会彻底回收

	* 运行期系统如果发现`NSZombieEnable`环境变量已设置，就会调配`dealloc`方法，对象所属的类会变成`_NSZombie_OriginalClass`
	
4. 僵尸类（zombie class）是从名为`_NSZombie_`的模板类里赋值出来的，只是充当一个标记。

5. 僵尸类没有实现任何方法，因此接收到的消息都要经过完整的消息转发机制
6. 僵尸类经过消息转发后，打印一条特殊的消息，其中指明僵尸对象所收到的消息及原来所属的类，然后应用程序终止

	
## 总结：
	
***1. 通过`NSZombieEnable`开启僵尸对象功能，系统不会真正回收对象，而将其转发为僵尸对象，以避免对象内存覆写***

***2. 系统会修改对象的isa指针，令其指向特殊的僵尸类，从而使对象变为僵尸对象。僵尸类能够响应所有的选择子，响应方法为：打印一条包含消息内容及接收者的消息，然后终止应用程序***

